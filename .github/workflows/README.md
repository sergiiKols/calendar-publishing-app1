# GitHub Actions - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –∫–ª—é—á–µ–π

#### –ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSH –∫–ª—é—á–∞ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)
ssh-keygen -t ed25519 -C "github-actions-deploy" -f ~/.ssh/github_actions

# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh-copy-id -i ~/.ssh/github_actions.pub user@your-server

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
cat ~/.ssh/github_actions.pub
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ ~/.ssh/authorized_keys –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```

#### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω
cat ~/.ssh/authorized_keys

# –ü—Ä–∞–≤–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
```

---

### –®–∞–≥ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Secrets –≤ GitHub

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**
3. –ù–∞–∂–º–∏—Ç–µ **New repository secret**

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ä–µ—Ç—ã:

| Name | Value | –ü—Ä–∏–º–µ—Ä |
|------|-------|--------|
| `SERVER_HOST` | IP –∞–¥—Ä–µ—Å –∏–ª–∏ –¥–æ–º–µ–Ω —Å–µ—Ä–≤–µ—Ä–∞ | `123.45.67.89` –∏–ª–∏ `server.example.com` |
| `SERVER_USER` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å SSH | `ubuntu` –∏–ª–∏ `user` |
| `SSH_PRIVATE_KEY` | –ü—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ `~/.ssh/github_actions` |
| `SERVER_PORT` | SSH –ø–æ—Ä—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) | `22` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) |
| `PROJECT_PATH` | –ü—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ | `/home/user/calendar-app` |

#### –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á:

```bash
cat ~/.ssh/github_actions
```

**–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –í–°–Å**, –≤–∫–ª—é—á–∞—è:
```
-----BEGIN OPENSSH PRIVATE KEY-----
...–≤—Å–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ...
-----END OPENSSH PRIVATE KEY-----
```

---

### –®–∞–≥ 3: –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤:

```bash
# –ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
git add .
git commit -m "Setup GitHub Actions deployment"
git push origin main
```

**GitHub –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
1. –û–±–Ω–∞—Ä—É–∂–∏—Ç push –≤ –≤–µ—Ç–∫—É `main`
2. –ó–∞–ø—É—Å—Ç–∏—Ç workflow
3. –ü–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH
4. –í—ã–ø–æ–ª–Ω–∏—Ç `git pull`
5. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–µ—Ç Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
6. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

---

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ø–ª–æ—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Actions**
3. –í—ã —É–≤–∏–¥–∏—Ç–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–π workflow
4. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π (–ø—Ä–∏ push):

```
–í—ã ‚Üí git push origin main
  ‚Üì
GitHub –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
  ‚Üì
GitHub Actions –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
  ‚Üì
–ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH
  ‚Üì
–û–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–¥ (git pull)
  ‚Üì
–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç Docker
  ‚Üì
‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω!
```

### –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π:

1. GitHub ‚Üí –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Üí **Actions**
2. –í—ã–±—Ä–∞—Ç—å **Deploy to Server**
3. –ù–∞–∂–∞—Ç—å **Run workflow** ‚Üí **Run workflow**

---

## –ß—Ç–æ –¥–µ–ø–ª–æ–∏—Ç—Å—è?

–ü—Ä–∏ –∫–∞–∂–¥–æ–º `git push origin main`:
- ‚úÖ –ö–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- ‚úÖ Docker –æ–±—Ä–∞–∑ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è
- ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (–Ω–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç—Å—è)

**–ù–ï –¥–µ–ø–ª–æ–∏—Ç—Å—è:**
- ‚ùå `.env` —Ñ–∞–π–ª (–æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è)
- ‚ùå –î–∞–Ω–Ω—ã–µ PostgreSQL (–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π volume)

---

## Troubleshooting

### –û—à–∏–±–∫–∞: "Permission denied (publickey)"

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh -i ~/.ssh/github_actions user@your-server

# –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –¥–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á –≤—Ä—É—á–Ω—É—é:
cat ~/.ssh/github_actions.pub | ssh user@your-server "cat >> ~/.ssh/authorized_keys"
```

### –û—à–∏–±–∫–∞: "docker-compose: command not found"

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å docker-compose
sudo apt update
sudo apt install docker-compose

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å docker compose (v2)
# –ò–∑–º–µ–Ω–∏—Ç–µ –≤ deploy.yml: docker-compose ‚Üí docker compose
```

### –û—à–∏–±–∫–∞: "Permission denied (docker)"

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker
sudo usermod -aG docker $USER

# –í—ã–π—Ç–∏ –∏ –≤–æ–π—Ç–∏ —Å–Ω–æ–≤–∞ –∏–ª–∏:
newgrp docker
```

### Workflow –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `.github/workflows/deploy.yml`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –ø—É—à–∏—Ç–µ –≤ –≤–µ—Ç–∫—É `main`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∫–ª–∞–¥–∫—É Actions –Ω–∞ GitHub - –≤–æ–∑–º–æ–∂–Ω–æ –µ—Å—Ç—å –æ—à–∏–±–∫–∏

---

## –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram:

–î–æ–±–∞–≤—å—Ç–µ –≤ `deploy.yml` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è:

```yaml
- name: üì± Telegram notification
  if: success()
  uses: appleboy/telegram-action@master
  with:
    to: ${{ secrets.TELEGRAM_CHAT_ID }}
    token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
    message: |
      ‚úÖ Calendar App deployed successfully!
      
      Commit: ${{ github.event.head_commit.message }}
      Author: ${{ github.actor }}
```

–î–æ–±–∞–≤—å—Ç–µ secrets:
- `TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (@BotFather)
- `TELEGRAM_CHAT_ID` - ID —á–∞—Ç–∞

### –î–µ–ø–ª–æ–π —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:

```yaml
on:
  push:
    branches:
      - main
    paths:
      - 'app/**'
      - 'components/**'
      - 'lib/**'
      - 'package.json'
      - 'Dockerfile'
      - 'docker-compose.yml'
```

### –î–µ–ø–ª–æ–π –≤ —Ä–∞–∑–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```yaml
on:
  push:
    branches:
      - main        # production
      - develop     # staging

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
        run: |
          if [ "${{ github.ref }}" == "refs/heads/main" ]; then
            echo "ENV=production" >> $GITHUB_ENV
            echo "SERVER=${{ secrets.PROD_SERVER }}" >> $GITHUB_ENV
          else
            echo "ENV=staging" >> $GITHUB_ENV
            echo "SERVER=${{ secrets.STAGING_SERVER }}" >> $GITHUB_ENV
          fi
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ **–•–æ—Ä–æ—à–æ:**
- SSH –∫–ª—é—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ GitHub Secrets (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã)
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- `.env` —Ñ–∞–π–ª –Ω–µ –¥–µ–ø–ª–æ–∏—Ç—Å—è (—Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)

‚ö†Ô∏è **–í–∞–∂–Ω–æ:**
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` –≤ Git
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ SSH –∫–ª—é—á–∏ (ed25519 –∏–ª–∏ RSA 4096)
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ GitHub Secrets
- –†–µ–≥—É–ª—è—Ä–Ω–æ –º–µ–Ω—è–π—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤ `.env`

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë—ã—Å—Ç—Ä—ã–π —Ñ–∏–∫—Å:

```bash
# –ù–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
nano app/page.tsx
git add .
git commit -m "Fix: typo in homepage"
git push origin main

# –î–µ–ø–ª–æ–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞ ~2-3 –º–∏–Ω—É—Ç—ã
```

### –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è:

```bash
git checkout -b feature/new-calendar-view
# ... —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ ...
git add .
git commit -m "Add: new calendar view"
git push origin feature/new-calendar-view

# –°–æ–∑–¥–∞—Ç—å Pull Request –Ω–∞ GitHub
# –ü–æ—Å–ª–µ merge –≤ main - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π
```

---

**üéâ –¢–µ–ø–µ—Ä—å –≤–∞—à –¥–µ–ø–ª–æ–π –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω!**

–ü—Ä–æ—Å—Ç–æ `git push` - –∏ —á–µ—Ä–µ–∑ –ø–∞—Ä—É –º–∏–Ω—É—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.
